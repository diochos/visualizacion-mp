/* =========================
   Visualización MP – Estilos globales
   Tipografía: Montserrat (400/500/600/700)
   Paleta Bepensa: naranja/negro/blanco + grises
   ========================= */

@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');

:root{
  /* Paleta corporativa */
  --c-bg: #0E0E10;          /* fondo general casi negro */
  --c-panel: #1A1A1D;       /* panel/targeta */
  --c-panel-2: #202024;     /* panel alterno */
  --c-text: #F5F5F7;        /* texto principal */
  --c-text-dim: #B8B8BF;    /* texto atenuado */
  --c-brand: #FF6D00;       /* naranja Bepensa */
  --c-brand-700: #E85F00;   /* hover */
  --c-brand-300: #FFA366;   /* acentos suaves */
  --c-border: #2A2A2F;      /* bordes sutiles */
  --c-ok: #23C55E;          /* verdes para positivos */
  --c-warn: #F59E0B;        /* amarillos para alertas */
  --c-bad: #EF4444;         /* rojos para errores */

  /* Layout */
  --radius-xl: 18px;
  --radius-lg: 12px;
  --radius-md: 10px;
  --shadow-1: 0 8px 24px rgba(0,0,0,.25);
  --gap: 16px;
  --maxw: 1200px;

  /* Tipografía */
  --f-base: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  --fs-xxl: clamp(28px, 3vw, 36px);
  --fs-xl: 20px;
  --fs-lg: 16px;
  --fs-md: 14px;
  --fs-sm: 12px;

  /* Colores sugeridos para gráficas (orden de series) */
  --ch-1: #FF6D00; /* naranja principal */
  --ch-2: #6B7280; /* gris */
  --ch-3: #10B981; /* verde */
  --ch-4: #3B82F6; /* azul */
  --ch-5: #F59E0B; /* ámbar */
  --ch-6: #8B5CF6; /* violeta */
  --ch-7: #EF4444; /* rojo */
  --ch-8: #14B8A6; /* teal */
}

* { box-sizing: border-box; }
html, body {
  height: 100%;
  background: radial-gradient(1200px 800px at 10% -10%, #151518 20%, transparent 60%) no-repeat,
              radial-gradient(900px 600px at 110% 20%, #18181b 10%, transparent 55%) no-repeat,
              var(--c-bg);
  color: var(--c-text);
  font-family: var(--f-base);
  line-height: 1.45;
}
a { color: var(--c-brand); text-decoration: none; }
a:hover { color: var(--c-brand-300); }
img { max-width: 100%; display: block; }

.container {
  max-width: var(--maxw);
  margin: 0 auto;
  padding: 24px;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--gap);
  margin-bottom: 18px;
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px;
}
.brand__logo {
  width: 36px; height: 36px;
  border-radius: 10px;
  background: linear-gradient(135deg, var(--c-brand) 0%, var(--c-brand-700) 100%);
  box-shadow: 0 6px 18px rgba(255,109,0,.35);
}
.brand__title {
  font-size: var(--fs-xxl);
  font-weight: 700;
  letter-spacing: .3px;
}

.tag {
  font-size: var(--fs-sm);
  color: var(--c-text-dim);
  border: 1px solid var(--c-border);
  border-radius: 999px;
  padding: 6px 10px;
}

.topbar {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

/* Selector de archivo (bonito) */
.file {
  position: relative;
}
.file input[type="file"] {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}
.file__btn {
  background: var(--c-brand);
  color: #fff;
  border: 0;
  padding: 10px 14px;
  border-radius: var(--radius-lg);
  font-weight: 600;
  box-shadow: 0 8px 20px rgba(255,109,0,.25);
  transition: transform .08s ease, background .15s ease;
}
.file__btn:active { transform: translateY(1px); }
.file__hint {
  font-size: var(--fs-md);
  color: var(--c-text-dim);
}

/* Tabs */
.tabs {
  margin-top: 14px;
  border-bottom: 1px solid var(--c-border);
  display: flex; gap: 6px; flex-wrap: wrap;
}
.tab {
  appearance: none;
  border: 1px solid var(--c-border);
  border-bottom: none;
  background: var(--c-panel);
  color: var(--c-text-dim);
  padding: 10px 14px;
  border-top-left-radius: var(--radius-lg);
  border-top-right-radius: var(--radius-lg);
  font-weight: 600;
  font-size: var(--fs-md);
  transition: background .15s ease, color .15s ease, border-color .15s ease;
}
.tab:hover { color: var(--c-text); }
.tab--active {
  background: linear-gradient(180deg, #232326 0%, #1B1B1E 100%);
  color: var(--c-text);
  border-color: #34343a;
  position: relative;
}
.tab--active::after {
  content: "";
  position: absolute;
  left: 0; right: 0; bottom: -1px; height: 2px;
  background: var(--c-brand);
}

/* Paneles */
.panel {
  background: var(--c-panel);
  border: 1px solid var(--c-border);
  border-radius: var(--radius-xl);
  padding: 18px;
  box-shadow: var(--shadow-1);
  margin-top: 18px;
}

.panel--ghost {
  background: transparent;
  border-style: dashed;
}

/* Grid utilitario */
.grid { display: grid; gap: var(--gap); }
.grid--2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
.grid--3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
@media (max-width: 900px){
  .grid--2, .grid--3 { grid-template-columns: 1fr; }
}

/* Tarjeta KPI */
.kpi {
  background: var(--c-panel-2);
  border: 1px solid var(--c-border);
  border-radius: var(--radius-lg);
  padding: 14px;
}
.kpi__label { font-size: var(--fs-md); color: var(--c-text-dim); }
.kpi__value { font-size: var(--fs-xl); font-weight: 700; }

/* Tabla base */
.table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  overflow: hidden;
  border-radius: var(--radius-lg);
  border: 1px solid var(--c-border);
}
.table th, .table td {
  padding: 12px 14px;
  font-size: var(--fs-md);
  border-bottom: 1px solid var(--c-border);
}
.table thead th {
  background: #232327;
  text-align: left;
  font-weight: 700;
}
.table tbody tr:hover { background: rgba(255,255,255,.02); }

/* Botones secundarios */
.btn {
  appearance: none;
  background: transparent;
  color: var(--c-text);
  border: 1px solid var(--c-border);
  padding: 10px 12px;
  border-radius: var(--radius-lg);
  font-weight: 600;
  cursor: pointer;
}
.btn:hover { border-color: #3a3a42; }


/* Helpers */
.muted { color: var(--c-text-dim); }
.hidden { display: none !important; }

/* Placeholder de gráficos */
.chart-placeholder {
  height: 340px;
  border: 1px dashed var(--c-border);
  border-radius: var(--radius-lg);
  display: grid;
  place-items: center;
  color: var(--c-text-dim);
  font-size: var(--fs-md);
}


/* Tabla compacta */
.table {
  table-layout: auto;   /* default, pero lo dejo explícito */
  width: 100%;          /* llena el contenedor, repartiendo según contenido */
  border-collapse: collapse;
}

.table th, .table td {
  padding: 8px 10px;             /* más compacto */
  font-size: 12px;               /* más pequeño */
  white-space: nowrap;           /* evita saltos raros */
  overflow: hidden;              /* oculta exceso */
  text-overflow: ellipsis;   
  width: auto !important; 
  word-break: break-word;   /* anula tus nth-child anteriores */    /* ... */
}
.table thead th { position: sticky; top: 0; z-index: 2; } /* header pegado (opcional) */

/* Anchos sugeridos por columna (ajústalos a tu gusto) */
.table thead th:nth-child(1),  .table tbody td:nth-child(1)  
.table thead th:nth-child(2),  .table tbody td:nth-child(2) 
.table thead th:nth-child(3),  .table tbody td:nth-child(3) 
.table thead th:nth-child(4),  .table tbody td:nth-child(4) 
.table thead th:nth-child(5),  .table tbody td:nth-child(5)  
.table thead th:nth-child(6),  .table tbody td:nth-child(6)  {  text-align:center; } /* Fecha */
.table thead th:nth-child(7),  .table tbody td:nth-child(7)  
.table thead th:nth-child(8),  .table tbody td:nth-child(8),
.table thead th:nth-child(9),  .table tbody td:nth-child(9),
.table thead th:nth-child(10), .table tbody td:nth-child(10),
.table thead th:nth-child(11), .table tbody td:nth-child(11),
.table thead th:nth-child(12), .table tbody td:nth-child(12),
.table thead th:nth-child(13), .table tbody td:nth-child(13) 

/* DataTables oscura + compacta para que combine */
.dataTables_wrapper .dataTables_filter input,
.dataTables_wrapper .dataTables_length select {
  background: #1A1A1D; border:1px solid #2A2A2F; color:#F5F5F7; border-radius:10px; padding:6px 8px;
}
.dataTables_wrapper .dataTables_info,
.dataTables_wrapper .dataTables_paginate {
  color:#B8B8BF;
}
.dataTables_wrapper .dataTables_paginate .paginate_button {
  background:#1A1A1D; border:1px solid #2A2A2F; color:#F5F5F7 !important; border-radius:10px;
  padding: 10px;
  cursor: pointer;
}
.dataTables_wrapper .dataTables_paginate .paginate_button.current {
  background:#FF6D00 !important; border-color:#FF6D00 !important; color:#fff !important;
}
.dataTables_paginate {
    cursor: pointer;
}


.table-controls{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; margin:8px 0;
}
.table-controls.top{ margin-top: 0; }
.table-controls.bottom{ margin-bottom: 0; }

/* Afinar DataTables dentro de nuestros contenedores */
#dt-length, #dt-filter, #dt-info, #dt-pager { display:flex; align-items:center; gap:8px; }
#dt-filter input, #dt-length select{
  background:#1A1A1D; border:1px solid #2A2A2F; color:#F5F5F7; border-radius:10px; padding:6px 8px;
}
#dt-pager .paginate_button{
  background:#1A1A1D; border:1px solid #2A2A2F; color:#F5F5F7 !important; border-radius:10px; margin-left:6px;
}
#dt-pager .paginate_button.current{
  background:#FF6D00 !important; border-color:#FF6D00 !important; color:#fff !important;
}

/* ========= Loader global a pantalla completa ========= */
html.noscroll, body.noscroll { overflow: hidden; }

#pageLoader{
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  background: rgba(14,14,16, .96);   /* tapa todo */
  z-index: 9999;
  transition: opacity .2s ease, visibility .2s ease;
}

#pageLoader.hidden{
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}

#pageLoader .pageLoader__box{
  display: flex; align-items: center; gap: 10px;
  background: var(--c-panel);
  color: var(--c-text);
  border: 1px solid var(--c-border);
  padding: 14px 16px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-1);
  font-family: var(--f-base);
}

#pageLoader .pageLoader__spinner{
  width: 28px; height: 28px;
  border-radius: 50%;
  border: 3px solid rgba(255,255,255,.25);
  border-top-color: var(--c-brand);
  animation: spin .8s linear infinite;
  flex: 0 0 28px;
}

@keyframes spin { to { transform: rotate(360deg); } }


/* realza el botón seleccionado */
#monthButtons .btn.active{ border-color: var(--c-brand); }
.btn{
  cursor:pointer
}

#customRange { pointer-events: auto; }
.period-overlay {
  position: relative; /* si tu panel ya es relative, puedes usar absolute + inset */
  display: inline-flex;
  align-items: center;
  gap: .5rem;
  color: var(--c-muted, #9aa2ad);
  padding: 6px 10px;
  border-radius: 8px;
  background: rgba(0,0,0,.25);
}
.hidden { display: none !important; }

/* deshabilitar clicks mientras carga */
.is-loading { pointer-events: none; opacity: .6; }

/* spinner */
.spinner {
  width: 14px; height: 14px;
  border: 2px solid rgba(255,255,255,.18);
  border-top-color: rgba(255,255,255,.65);
  border-radius: 50%;
  animation: spin .8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg) } }


/* Asegura que el panel del periodo sea el contenedor del overlay */
.panel--ghost { position: relative; }

/* Overlay que cubre la franja del periodo (botones + rango) */
.period-overlay {
  position: absolute;
  inset: 36px 12px 12px 12px;   /* top/right/bottom/left dentro del panel */
  display: none;                /* se enciende vía JS */
  align-items: center;
  justify-content: center;
  gap: .5rem;
  z-index: 5;
  border-radius: 12px;
  background: rgba(0,0,0,.35);
  color: var(--c-muted, #9aa2ad);
}

/* utilidades ya usadas */
.hidden { display: none !important; }
.is-loading { pointer-events: none; }
.spinner {
  width: 14px; height: 14px;
  border: 2px solid rgba(255,255,255,.18);
  border-top-color: rgba(255,255,255,.65);
  border-radius: 50%;
  animation: spin .8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg) } }

/* Estilo corporativo para selects */
select {
  appearance: none;         /* quita estilo nativo */
  -webkit-appearance: none;
  -moz-appearance: none;
  
  background-color: #1e1e1e;   /* fondo oscuro */
  color: #f0f0f0;              /* texto claro */
  border: 1px solid var(--c-border, #444);
  border-radius: 6px;
  padding: 6px 28px 6px 10px;
  font-size: 0.95rem;
  font-family: inherit;
  cursor: pointer;
  transition: border-color .2s, background-color .2s;
}

/* Hover/focus */
select:hover {
  border-color: var(--c-brand, #ff6600);
}
select:focus {
  outline: none;
  border-color: var(--c-brand, #ff6600);
  box-shadow: 0 0 0 2px rgba(255,102,0,0.4);
}

/* Opciones internas */
select option {
  background-color: #1e1e1e;
  color: #f0f0f0;
  padding: 6px;
}

/* Opciones deshabilitadas */
select option:disabled {
  color: #777;
  background-color: #1a1a1a;
}

/* Flechita custom */
select::after {
  content: "▼";
  position: absolute;
  right: 10px;
  pointer-events: none;
}
select {
  background-image: url("data:image/svg+xml;utf8,<svg fill='%23ff6600' ... />");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 12px;
}


/* ===== Panel para charts (look Bepensa) ===== */
.panel--chart{
  background: linear-gradient(180deg, rgba(255,255,255,.02) 0%, rgba(255,255,255,.00) 100%), var(--c-panel);
  border: 1px solid var(--c-border);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-1);
  padding: 14px 16px 10px;
  margin-top: 16px;
}
.panel__head{
  display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px;
}
.panel__title{ display:flex; align-items:center; gap:10px; }
.panel__title h3{ margin:0; font-weight:700; letter-spacing:.2px; }
.panel__title .dot{
  width:10px; height:10px; border-radius:50%;
  background: radial-gradient(circle at 40% 40%, var(--c-brand) 0%, var(--c-brand-300) 60%, transparent 70%);
  box-shadow: 0 0 18px rgba(255,109,0,.45);
}
.panel__meta{ color: var(--c-text-dim); }

.chart-wrap{
  position:relative;
  height: 500px;            /* alto fijo para evitar loops de resize */
  width: 100%;
  border-radius: 12px;
  background: radial-gradient(800px 300px at 10% -30%, rgba(255,109,0,.06), transparent 50%),
              radial-gradient(600px 240px at 110% 120%, rgba(255,109,0,.05), transparent 45%),
              #141416;
  border: 1px solid #212127;
  overflow: hidden;
}
#paretoMP{ width:100%; height:100%; display:block; }


/* Contenedor único para TODAS las gráficas */
#chartsArea{
  display: grid;
  gap: 16px;
  margin-top: 12px;
}

/* Dentro de #chartsArea, los paneles no necesitan margen extra */
#chartsArea > .panel--chart{ margin-top: 0; position: relative; z-index: 0; }

/* Rejilla y alturas de los 3 paneles de finanzas */
#financeGrid{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 16px;
}
#financeGrid .panel--chart .chart-wrap{ height: 280px; }
#riskMapCard .chart-wrap{ height: 500px; }   /* burbuja más alta */
#financeGrid canvas{ width:100% !important; height:100% !important; display:block; }

@media (max-width: 900px){
  #financeGrid{ grid-template-columns: 1fr; }
  #riskMapCard{ grid-column: 1 / -1 !important; }
}

/* Overlay de carga a pantalla completa */
#chartsLoader{
  /* oculto hasta que tenga .is-active */
  display: none;

  /* pantalla completa, por encima de todo */
  position: fixed;
  inset: 0;               /* top/right/bottom/left: 0 */
  z-index: 9999;

  /* centrar contenido */
  justify-content: center;
  align-items: center;

  /* oscurecer + blur del fondo */
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(4px);
}

/* cuando está activo, se muestra como flex */
#chartsLoader.is-active{ display: flex; }

/* cajita centrada (opcional, ver B) */
#chartsLoader .box{
  display: flex; gap: 12px; align-items: center;
  padding: 14px 18px;
  border-radius: 14px;
  background: rgba(20,22,26,.92);
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: 0 12px 40px rgba(0,0,0,.45);
  color: var(--c-text, #e9edf3);
}

/* spinner */
#chartsLoader .spin{
  width: 20px; height: 20px;
  border-radius: 50%;
  border: 3px solid rgba(255,255,255,.25);
  border-top-color: var(--c-brand, #ff8a00);
  animation: spin 800ms linear infinite;
}

/* texto */
#chartsLoader .title{
  font-size: 16px;
  font-weight: 600;
  letter-spacing: .3px;
  opacity: .95;
}

@keyframes spin{ to{ transform: rotate(360deg); } }


/* Tabla estable (ancho fijo por celda y sin crecer infinito) */
#tablaLinea{
  width: 100%;
  table-layout: fixed;         /* ← clave: evita auto-medición costosa */
  border-collapse: collapse;
}
#tablaLinea th, #tablaLinea td{
  white-space: nowrap;         /* no saltar línea */
  overflow: hidden;            /* recorta */
  text-overflow: ellipsis;     /* … al final */
}

/* Anchos balanceados (ajústalos si quieres) */
#tablaLinea thead th:nth-child(1){ width: 44%; } /* Materia Prima */
#tablaLinea thead th:nth-child(2){ width: 18%; } /* Teórica */
#tablaLinea thead th:nth-child(3){ width: 18%; } /* Real */
#tablaLinea thead th:nth-child(4){ width: 12%; } /* Merma */
#tablaLinea thead th:nth-child(5){ width: 8%;  } /* % Merma */

/* Altura contenida con scroll (evita que “tome” toda la página) */
#tablaLineaWrap{              /* crea este wrapper si no existe (ver abajo) */
  max-height: 60vh;
  overflow: auto;
}
